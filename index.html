document.getElementById("faltaForm").addEventListener("submit", async function (event) {
  event.preventDefault();
  
  // Mostrar loading
  const button = event.target.querySelector("button");
  const originalText = button.textContent;
  button.textContent = "Enviando...";
  button.disabled = true;

  try {
    const formData = new FormData(event.target);
    const params = new URLSearchParams();
    
    params.append("nome", formData.get("nome"));
    params.append("data", formData.get("data"));
    params.append("status", formData.get("status"));
    
    // URL corrigida - remova espaços!
    const scriptUrl = "https://script.google.com/macros/s/AKfycbyiuOD3mv12cXVLtTr8JaEQNgS5iavOM8h4dg5czkIReJQTd_S5FNZLmNANqQutSXA7ngqiA/exec";
    
    // Solução com proxy CORS (descomente se necessário)
    // const proxyUrl = "https://corsproxy.io/?";
    // const fullUrl = proxyUrl + encodeURIComponent(scriptUrl);
    
    const response = await fetch(scriptUrl, {
      method: "POST",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded",
      },
      body: params.toString()
      // REMOVA o mode: "no-cors" para poder ler a resposta
    });
    
    if (!response.ok) {
      throw new Error(`Erro HTTP: ${response.status}`);
    }
    
    const data = await response.json();
    
    if (data.success) {
      alert(data.message);
      event.target.reset();
    } else {
      throw new Error(data.message || "Erro desconhecido");
    }
    
  } catch (err) {
    console.error("Erro:", err);
    alert("Erro ao enviar: " + err.message);
  } finally {
    button.textContent = originalText;
    button.disabled = false;
  }
});
